## knox

http://knox.apache.org/


Apache Knox Gateway是用于与Apache Hadoop部署的REST API和UI交互的应用程序网关。Knox Gateway为与Apache Hadoop集群的所有REST和HTTP交互提供一个单一的访问点。

KNOX提供三组面向用户的服务：

- 代理服务：Apache Knox项目的主要目标是通过代理HTTP资源提供对Apache Hadoop的访问。
- 认证服务：对USTAPI访问以及UIS的WebSSO流进行身份验证。LDAP/AD，基于头的PROAUTH，Kerberos，SAML，OAUTH都是可用的选项。
- 客户服务：可以通过DSL编写脚本或直接将Knox Shell类作为SDK来完成客户端开发。

简单的说，Apache Knox Gateway是一款用于保护Hadoop生态体系安全的代理网关系统，为Hadoop集群提供唯一的代理入口。Knox以类似反向代理的形式挡在汲取你的前面，隐匿部署细节（例如端口号和机器名等），接管所有用户的HTTP请求（例如WEB UI 控制台访问和RESTful 服务调用），以此来保护集群安全。不仅如此，Knox还能担任认证网关的角色。


Knox网关本质上是一款基于Jetty实现的高性能反向代理服务器，通过内置的过滤器链来处理URL请求，支持使用LADP进行用户身份认证。Knox网关在架构设计上具有良好的可扩展性，这种扩展性主要通过Service和Provider这两个扩展性框架来实现。Server扩展性框架还提供了一种网关新增的HTTP或RESTful服务端点的途径，例如WebHDFS就是以新建的Service的形式加入Knox网关的。而Provider扩展性框架则是用来定义并实现相应Service所提供的功能，例如端点的用户认证或是WebHDFS中的文件上传等功能。
 

LDAP（全称：“Weight Diretory Access Protocol”）是轻量级目录访问协议的简称。它是一种树形目录结构的轻量级数据库，能够提供快速检索能力。常用与存储企业内部组织机构与用户数据。

使用Knox网关自带的LDAP服务，无须更改它的配置便可以直接使用。作为代理网关，Knox将所有支持代理的RESTful服务和页面进行了一层地址映射。

LDAP通过定义schema模型来描述一个对象，模型中有一些重要的概念，也就是一系列常用名词缩写。

1.什么是目录服务
目录是一类为了浏览和搜索数据二十几的特殊的数据库，例如：最知名的的微软公司的活动目录（active directory）就是目录数据库的一种。目录服务时按照梳妆形式存储信息的，目录包含基于属性的描述性信息，并且支持高级的过滤功能。
一般来说，目录不支持大多数事务性数据库所支持的高吞吐两盒复杂的更新操作。目录进行更新操作，可以说是要么全部，要么都不的原子操作，目录服务适合的业务应用在于提供大量的查询和搜索操作。
为了保证目录数据的可用性和卡可靠性，她们在确保提供快速的查询和搜索操作的同事，还提供了主从服务器同步目录数据信息的能力，这相当于传统的Mysql数据库的主从同步一样，可以最大限度的确保基于目录业务的持续可用性。
广义的目录服务概念，可以有多重不同的方式来提供目录服务，不同的目录所允许存储的信息是不同的，在信息如何被引用，查询，更新以及防止未经守群的访问等问题上，不同的目录所允许存储的信息是不同的，在信息如何被引用，查询，更新以及防止未经授权的访问等问题上，不同的目录的处理方式也有诸多的不同。一些目录服务时为本地的，只提供受限的服务，（比如，单机上的finger服务）。另一些服务时大范围的（global），提供广阔得多的服务（比如面向整个因特网）。大范围的服务通常是分布式的，这也就意味着数据是分布在多台机器上的，这些计数器一起来提供目录服务。典型的大范围服务定义一个统一的名称空间（namespace）来给出一个相同的数据试图（data view），而不管你相对于数据所在的位置。DNS是一个典型的大范围分布式目录服务的例子。

2.什么是ldap
LDAP是Lightweight Directory Access Protocol (轻量级目录访问协议)的缩写。正如它的名字所表明的那样，它是一个轻量级的目录访问协议，特质基于X.500的目录访问协议的简化版本。LADP运行在TCP/IP或者其他的面向连接的传输服务至上。LADP完整的技术规范由RFC2251 “The Lightweight Directory Access Protocol（V3）”和其他几个在RFC3377中定义的文档组成。我们不需要研究的那么深，因为我们又不会对它进行二次开发，我们运维只要能了解到它的目录结构，以及它的用法就OK了，因此我们可以用两句话总结以上内容：
a>.LADP是轻量目录访问协议（Lightweight Directory Access Protocal）的缩写；
b>.LADP标准实际上是在X.500标准基础 上产生的一个简化版本；

3.什么是X.500
X.500由ITU-T和ISO定义，它实际上不是一个协议，而是有一个协议族组成，包括了从X.501到X.525等一系列非常完整的目录服务协议。X。500主要具备以下特征：
a>.分散维护
运行X.500的每一个站点只负责人本地目录部分，可以立即更新和维护操作；
b>.搜索性能
X.500具有强大的搜素功能，支持用户建立的任意复杂查询。
c>.单一全局命名空间
类似于DNS,X.500为用户提供单一同性命名空间（Single Homogeneous Namespace）。与DNS相比，X。500目录中定义了信息结构，运行本地扩展。
d>.结构化信息结构
X.500目录中定义了信息结构，运行本地扩展。
e>.基于标准的目录服务
由于X.500可以被用于建立一个基于标准的目录，因此在某种意义上，请求应用目录信息（电子邮件，资源自动分配器，特定目录工具）的应用程序就能访问重要且有简直的信息。
从技术上来说，LADP是一个到X.500目录服务的目录访问协议，X.500是一个OSI目录协议。最初，LADP客户单通过网关（gateway）访问X.500目录服务。在客户和网关之间运行LADP和X.500目录访问协议（Directory Access Protocol，DAP），而X.500目录访问协议时位于网关和X.500之间的。DAP是一个重量级的协议，在整个OSI协议栈上进行操作，而且需要占用大量的计算资源。LADP被设计的在TCP/IP层上操作，以小得多的代价实现了大多数DAP的功能。
虽然LADP仍旧可以通过网关访问X.500目录服务器，但是现在通常都是在X.500服务器上直接实现LADP。
单独的LADP守护程序sladp，可以被看做是一个轻量级的X.500目录服务器。也就是说，他没有实现X.500完整的DAP协议。作为一个轻量级的目录服务器，sladp实现的仅仅是X.500模型的一个子集。我们可以理解是LADP是X.500的一个简单的实现。

4.LADP与X.500的相同点
LADP是X.500标准中的目录访问协议DAP的一个子集，可用于建立X.500目录。因此这两个目录技术标准有着许多的共同之处：
a>.在平台上，都实现了一个通用的平台结构，提供了一个操作系统和应用程序需要的信息服务类型，可以被许多平台和应用程序接收和实现；
b>.在信息模型上，都是用了项，对象类，属性等概念的模式来描述信息；
c>.在命名空间上方面，都是用了目录信息结构和层次命名模型；
d>.在功能模型上，都使用了相似的操作命令来管理目录信息；
e>.在认证框架方面，都可以实现用户名称和密码，或者基于安全加密方式的认真机制；
f>.早灵活性上，他们的目录规模都可大可小，达到全球目录树，小到只有一台目录服务器；
g>.在分布性方面，目录信息都可以分布在多个目录服务器中，这些服务器可以由各个组织管理，既保证了目录信息总体结构的一致性，又满足了分级管理的需要。

5.LADP与X.500的差别
a>.LADP基于Internet协议，X.500基于OSI（开放式系统互联）协议，建立在应用层上的X.500目录访问协议DAP，需要在OSI会话层和表示层上进行许多的建立连接和包处理的任务，需要特殊的网络软件实现对网络的访问；LADP则直接运行在更简单和更通用的TCP/IP或其他可靠的传输层协议上，避免了在OSI会话和表示层的开销，是链接的建立和包的处理更简单，更快，对于互联网和企业网应用更理性。
b>.LADP协议更为简单，LADP继承了X.500最好的特性，同时去掉了它的复杂性，LADP通过使用查找操作实现列表方式和读操作，另一方面省去了X.500中神猫的和很少使用的服务控制和安全特性，只保留常用的特性，简化了LADP的实现。
c>.LADP通过引用机制实现分布式访问，X.500 DSA通过服务器之间的链操作实现分布式的访问，这样查询的压力九中与服务器端；而LADP通过客户端API实现分布式操作（对于应用透明）平衡了负载；
d>.LADP实现具有低费用，已配置和一管理的特点，经过性能测试，LADP比X.500㕛更少的响应时间；LADP提供了满足应用程序对目录服务所需求的特性。

