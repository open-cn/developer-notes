## sql




### SQL代码编码原则和规范

https://help.aliyun.com/document_detail/137491.html

##### 编码原则
SQL代码的编码原则如下：

- 代码功能完善。
- 代码行清晰、整齐，代码行的整体层次分明、结构化强。
- 代码编写充分考虑执行速度最优的原则。
- 代码中需要添加必要的注释，以增强代码的可读性。
- 规范要求并非强制性约束开发人员的代码编写行为。实际应用中，在不违反常规要求的前提下，允许存在可以理解的偏差。
- SQL代码中应用到的所有SQL关键字、保留字都需使用全大写或小写，例如select/SELECT、from/FROM、where/WHERE、and/AND、or/OR、union/UNION、insert/INSERT、delete/DELETE、group/GROUP、having/HAVING和count/COUNT等。不能使用大小写混合的方式，例如Select或seLECT等方式。
- 4个空格为1个缩进量，所有的缩进均为1个缩进量的整数倍，按照代码层次对齐。
- 禁止使用select *操作，所有操作必须明确指定列名。
- 对应的括号要求在同一列的位置上。

##### SQL编码规范
SQL代码的编码规范如下：

- 代码头部
    代码头部添加主题、功能描述、作者和日期等信息，并预留修改日志及标题栏，以便后续添加修改记录。注意每行不超过80个字符，模板如下。
    ```
    -- MaxCompute(ODPS) SQL
    --**************************************************************************
    -- ** 所属主题: 交易
    -- ** 功能描述: 交易退款分析
    -- ** 创建者 : 有码
    -- ** 创建日期: 20170616 
    -- ** 修改日志:
    -- ** 修改日期 修改人 修改内容
    -- yyyymmdd name comment 
    -- 20170831 无码 增加对biz_type=1234交易的判断 
    --**************************************************************************
    ```
- 字段排列要求
    + SELECT语句选择的字段按照每行1个字段的方式编排。
    + 首个选择的字段与SELECT之间隔1个缩进量。
    + 换行缩进2个缩进量后，添加逗号再输入其它字段名。
    + 2个字段之间的逗号分隔符紧跟在第2个字段的前面。
    + AS语句应与相应的字段在同一行，多个字段的AS建议尽量对齐在同一列上。as语句
- INSERT子句排列要求
    INSERT子句写在同一行，请勿换行。

- SELECT子句排列要求
    SELECT语句中所用到的from、where、group by、having、order by、join和union等子句，需要遵循如下要求：
    + 换行编写。
    + 与相应的SELECT语句左对齐编排。
    + 子句首个单词后添加2个缩进量，再编写后续的代码。
    + WHERE子句下的逻辑判断符and、or等，与WHERE左对齐编排。
    + 超过2个缩进量长度的子句加1个空格后，再编写后续代码，例如order by和group by等。超过两个缩进量
- 运算符前后间隔要求
    算术运算符、逻辑运算符前后要保留1个空格，并写在同一行（超过每行80个字符长度的限制除外）。运算符
- CASE语句的编写
    CASE语句可以用于SELECT语句中对字段值进行判断取值的操作。CASE语句编排的规则如下：
    + WHEN子语在CASE语句的同一行，并缩进1个缩进量后开始编写。
    + 每个WHEN子句尽量在1行内编写，如果语句较长可以换行。else子句
    + CASE语句必须包含ELSE子语，ELSE子句与WHEN子句对齐。
- 查询嵌套编写规范
    在数据仓库系统ETL开发中经常使用子查询嵌套，其编写规范示例如下。子查询
- 表别名定义约定
    + 一旦在SELECT语句中给操作表定义了别名，在整个语句中对此表的引用都必须以别名替代，所以需要给所有的表添加别名。
    + 表别名采用简单字符命名，建议按a、b、c、d…的顺序进行命名，并避免使用关键字。
    + 多层次的嵌套子查询别名之前要体现层次关系，SQL语句的别名需要分层命名，从第1层次至第4层次，分别用P（Part） 、S（Segment）、 U（Unit） 和D（Detail）表示。您也可以用a、b、c、d来表示第1层次到第4层次。对于同一层次的多个子句，在字母后加1、2、3、4……区分，并根据情况对表别名添加注释。
- SQL注释
    + 每条SQL语句均应添加注释说明。
    + 每条SQL语句的注释单独成行，并放在语句的前面。
    + 字段注释紧跟在字段后面。
    + 对不易理解的分支条件表达式添加注释。
    + 对重要的计算添加注释，说明其功能。
    + 过长的函数实现，应将其语句按实现的功能分段，添加注释进行说明。
    + 添加常量及变量的注释时，应注释被保存值的含义（必选），合法取值的范围（可选）。
    + 将鼠标放置对应SQL语句之后，使用Crtl+/或Cmd+/快捷键即可注释当前语句。如果您需要注释多行语句，则可以选中需要注释的语句，使用Crtl+/或Cmd+/批量完成注释。

##### 说明
Windows系统仅支持使用Crtl+/快捷键注释SQL语句。<br/>
Mac系统仅支持使用Cmd+/快捷键注释SQL语句。<br/>








