## 防火长城

Great Firewall of China，简写为Great Firewall，缩写GFW

### 概述

中国防火墙或中国国家防火墙，指中华人民共和国政府在其管辖因特网内部建立的多套网络审查系统的总称，包括相关行政审查系统。

由于频繁地被使用，GFW已被用做动词，GFWed是指被防火长城所屏蔽。GFW中的主要技术包括国家入口网关的IP封锁、主干路由器的关键字过滤阻断、域名劫持和HTTPS证书过滤等4种。（《计算机伦理学》，冯继宣主编，2011年）

在2011年《环球时报》的一篇英文报道中，北京邮电大学原校长方滨兴确认自己是长城防火墙（GreatFirewall）的首要设计者。方滨兴在报道中称，他家里电脑有6个VPN（虚拟专用网络）账号，“但只用它们测试GFW与VPN谁更厉害”。此前一年，《人民邮电报》首次在报道中称方为“国家防火墙（GFW）之父”。

- 2005年，方滨兴当选中国工程院院士。
- 2006年，方滨兴被任命为国家计算机网络与信息安全管理中心名誉主任。
- 2007年12月，方滨兴担任北京邮电大学校长（至2013年6月）。
- 2013年6月，方滨兴称因身体原因，不再连任北邮校长职务。
- 2014年11月19日，方滨兴在世界互联网大会做题为《物联网搜索技术》的演讲。
- 2016年3月25日，中国网络空间安全协会在北京举行成立大会，方滨兴当选为中国网络空间安全协会理事长。8月，担任哈尔滨工业大学（深圳）计算机科学与技术学院教授、首席学术顾问。
- 2017年7月，方滨兴团队30多人整体加入广州大学，成立广州大学网络空间先进技术研究院，担任名誉院长。


### 审查与封锁技术

IP封锁、路由黑洞、DNS污染、TCP重置攻击、深度包检测、对特定网站的封锁

VPN的开发目的是给企业内网直接传输加密数据，最重要的就是安全性，相反VPN的流量特征变得很明显，特别是SSL VPN类型，比如Openvpn有SSL证书的加密，安全性不必多说，但是握手依然是明文，流量更加明显，导致匹配流量特征很容易，一旦链接Openvpn那就是秒封。

VPN目前就科学上网方面来讲，PPTP大部分地区已死，L2TP大部分地区已经出现干扰和断开连接情况，Openvpn一封一个准。而anyconnect大多数都是企业用的，所以墙不敢乱封，IKEv1/IKEv2需要注意证书中间人攻击问题。
所以，在VPN科学上网这方面，一些地区已经根据VPN的流量特征做出了相应的匹配策略，可以有效封杀VPN了。

#### 原理

借助代理服务器：P2P、网页代理、SSH、VPN代理、自动配置、反向代理

不借助代理服务器：HTTPS、desync、Hosts、DNSCrypt、域前置、ECH


#### 启蒙：无界/自由门

这两个软件的原理大概就是通过经常变换代理服务器的地址，提供http和socks协议的代理。


#### 直达目的地：host

在防火墙的最初阶段，被墙的网站还没那么多。尤其是最常用的谷歌并没有完全被封锁，GFW会针对谷歌的域名进行DNS投毒。

封锁升级，不是针对 IP 地址，而是针对每一个网络连接。受限于为数不多的几个出入境节点，网民的每一个出境网络连接实际上都被扫描过一遍。HTTP协议的设计者哪能想到中国人的这些大智慧都用在研究封锁上了，所以设计时并没有考虑到这点。导致HTTP/HTTPS协议的特征非常明显，看连接的前几十个字节就能认出来了。


#### 免费的午餐：Goagent

利用Google App Engine平台，在上面搭设代理服务器，通过HTTPS协议翻墙。还能实现通过pac配置条件，让国内数据直连，境外数据走代理。这其实就是用谷歌服务器搭的一个梯子。

2015年8月25日，GoAgent项目被作者自行删除。删除后几小时之内，GitHub遭到了DDoS攻击。


#### 另辟蹊径：西厢计划

西厢计划不是一个协议或是服务，而是针对TCP连接重置、DNS劫持、IP封锁和URL关键字过滤的一组工具。比如GFW只检测出境的流量，而不检测入境的。通过让回程流量直连可以节省很多时间。
后来随着GFW的升级，可钻的空子越来越少。西厢计划终结。


#### 去中心化P2P：Tor

Tor是美国开发的一款自由软件。初衷也不是为了翻墙，而是为了匿名。在你和目标服务器之间，通过三个节点进行中转。这样目标服务器就没法知道你的真实IP。
Tor还可以建立只能通过Tor网络访问的网站，这就是所谓的暗网。曾经很有名的黑市“丝绸之路”就只能通过Tor访问，在上面你可以用比特币购买各种违禁品。
尽管主要用途是匿名而不是翻墙，但如果最终的出口节点位于境外，也是能起到翻墙的作用的。只是你应该能想象到，经过三个节点的中转，Tor的速度非常慢。


#### 改变历史：Shadowsocks

Shadowsocks是由若干人因为兴趣而制作的一个项目，位于github的clowwindy/shadowsocks，主要开发者和领导者是clowwindy。第一个版本是作者于2012年4月20日在v2ex上分享“发一个自用了一年多的翻墙工具shadowsocks”。

2015年8月22日，Clowwindy在GitHub上称，警察在两日前要求他停止开发Shadowsocks项目并删除其所有代码。之后他删去Github上的源码及相关文档，现在已经跑路美利坚。但是应网友要求，另一个开发者把 v2.5.8 的一些严重BUG修复了更新为 v3.0，然后宣布不再管了。

尽管如此，Git仓库的日志显示该项目被移除以前就有大量的复刻副本，不少副本仍然有用户维护。Shadowsocks项目页本身也陆续恢复了内容，并转交由多人维护，各大Linux包的软件仓库均有各式Shadowsocks的实现的包仍持续更新可用，目前的Shadowsocks更新基本上来自这些匿名作者运行。

Shadowsocks是一种基于Socks5代理方式的加密传输协议，也可以指实现这个协议的各种开发包。开发包使用Python、C、C++、C#、Go语言等编程语言开发，大部分主要实现(iOS平台的除外)采用Apache许可证、GPL、MIT许可证等多种自由软件许可协议开放源代码。

Shadowsocks分为服务器端和客户端，在使用之前，需要先将服务器端程序部署到服务器上面，然后通过客户端连接并创建本地代理。客户端覆盖多个主流操作系统和平台，包括Windows、macOS、Android、Linux和iOS系统和路由器（OpenWrt）等。

Shadowsocks部署简单，对服务器配置要求低，使用自行设计的协议进行加密通信。加密算法有AES、Blowfish、ChaCha20、RC4等，所有的流量都经过算法加密，允许自行选择算法。因此这个协议一经推出，就成为最流行的翻墙协议。毕竟和VPN不同，Shadowsocks就是为翻墙而设计的。

Shadowsocks的运行原理与其他代理工具基本相同，使用特定的中转服务器完成数据传输。但这是Socks 5的加密版本，无法被检测出来。并且可以针对境内外流量自动分流。

Shadowsocks 本身不是代理，但（通常）是帮助连接到第三方SOCKS5代理的客户端软件，类似于Secure Shell (SSH) 隧道。连接后，可以通过代理引导互联网流量。与 SSH 隧道不同，shadowsocks 还可以代理用户数据报协议 (UDP) 流量。

除创建TCP连接外无需握手，每次请求只转发一个连接，无需保持“一直连线”的状态，因此在移动设备上相对较为省电。

Shadowsocks通过异步I/O和事件驱动程序运行，响应速度快。

2017年9月21日，一篇名为《The Random Forest based Detection of Shadowsock's Traffic》的论文在IEEE发表，该论文介绍了通过随机森林算法检测Shadowsocks流量的方法，并自称可达到85％的检测精度，虽然该论文的有效性遭到网友质疑，但机器学习配合GFW已经实现的深度数据包检测来识别网络流量特征的做法是实际可行的，而且还适用于任何网络代理协议而不仅仅局限于Shadowsocks。

Clowwindy语Shadowsocks的最初只是“自用”，而不是提供密码学意义的安全，所以Shadowsocks自行设计的加密协议对双方的身份验证仅限于预共享密钥，亦无完全前向保密，也未曾有安全专家公开分析或评估协议及其实现。

Shadowsocks在SIP003提案中支持了插件，插件让Shadowsocks的流量可以通过不同的插件进行混淆加密或其他处理。目前使用较多的插件有v2ray-plugin等。通过插件对Shadowsocks进行流量混淆后，通常可以降低被GFW识别出来的几率，从而达到更稳定地突破网络封锁的目的。

AEAD加密方式（AES-GCM、Chacha20-poly1305）在SIP004提案提出并在SIP007提案实现，这些加密方式被认为可以提供密码学意义的安全(“保密性，完整性，可用性”)，之前AES CFB、AES CTR、RC4、Chacha20等没有认证的加密方式仍被允许存在。

为了确保安全，Shadowsocks加入AEAD加密方式（AES-GCM、Chacha20-poly1305），取代之前AES CFB、AES CTR、RC4、Chacha20等没有认证的加密(V2ray-core v4.31.0彻底抛弃了流加密算法，仅支持AEAD加密算法)。

2021年2月28日，GitHub用户RPRX提出Shadowsocks AEAD加密方式设计存在严重漏洞，无法保证通信内容的可靠性，随后开发者验证了本地echo自交思路的可行性。3月1日，RPRX又提出可利用服务端防重放机制使Shadowsocks、Vmess等未知流量代理实质性失效，随后gfw-report验证了这一思路的可行性。

##### ShadowsocksR

破娃酱@breakwa11在Github上主导了SSR分支breakwa11/shadowsocksr，吸取SS的功能并自主增加功能。ShadowsocksR主要特点是增加了一些人性化功能，比如服务器连接统计、连接管理、协议转换、多重代理等。在Shadowsocks的基础上增加了一些数据混淆方式，称修复了部分安全问题并可以提高QoS优先级。后来贡献者Librehat也为Shadowsocks补上了一些此类特性，甚至增加了类似Tor的可插拔传输层功能。SSR作者声称SS不够隐秘，易于被防火墙监测到，SSR在改善了搞混和协议，更难被防火墙监测到。简易地说，SSR是SS的改良版。

ShadowsocksR开始时曾有过违反GPL、发放二进制时不发放源码的争议，使得原开发作者不满。不过后来ShadowsocksR项目由breakwa11转为了与Shadowsocks相同的GPL、Apache许可证、MIT许可证等多重自由软件许可协议。

2017年7月19日，breakwa11在Telegram频道ShadowsocksR news里转发了深圳市启用SS协议检测的消息并被大量用户转发，引发恐慌。7月24日，breakwa11发布了闭源的SS被动检测程序，引发争议。

2017年7月27日，breakwa11遭到自称“ESU.TV”（恶俗TV）的不明身份人士人身攻击，对方宣称如果不停止开发并阻止用户讨论此事件将发布更多包含个人隐私的资料，随后breakwa11表示遭到对方人肉搜索并公开个人资料的是无关人士，为了防止对方继续伤害无关人士，breakwa11将删除GitHub上的所有代码、解散相关交流群组，停止ShadowsocksR项目。但项目已被多人fork，并有人在其基础上继续发布新的版本，例如较为知名的SSRR（页面存档备份，存于互联网档案馆）（ShadowsocksRR）。目前ShadowsockR电脑板更新到的最新版本是v4.7.0，安卓版应该是v3.4.0.7。

因为Shadowsocks的标志是一个纸飞机，因此现在也会把提供翻墙服务的服务器称作机场。
为了避免关键词过滤，现在ShadowsocksR被昵称为SSR酸酸乳。Shadowsocks被简称为SS酸酸。

#### V2Ray和Project V

V2Ray是Victoria Raymond以及其社群团队开发的Project V下的一个工具。Project V是一个工具集合，号称可以帮助其使用者打造专属的基础通信网络。Project V的核心工具称为V2Ray，其主要负责网络协议和功能的实现，与其它Project V通信。V2Ray可以单独运行，也可以和其它工具配合，以提供简便的操作流程。开发过程主要使用Go语言，Core采用MIT许可证并开放源代码。

Shadowsocks 是一个纯粹的代理工具，而 V2Ray 定位为一个平台，任何开发者都可以利用 V2Ray 提供的模块开发出新的代理软件。
了解 Shadowsocks 历史的同学都知道，Shadowsocks 是 clowwindy 开发的自用的软件，开发的初衷只是为了让自己能够简单高效地科学上网，自己使用了很长一段时间后觉得不错才共享出来的。V2Ray 是 clowwindy 被喝茶之后 V2Ray 项目组为表示抗议开发的，一开始就致力于让大家更好更快的科学上网。
由于出生时的历史背景不同，导致了它们性格特点的差异。
简单来说，Shadowsocks 功能单一，V2Ray 功能强大。听起来似乎有点贬低 Shadowsocks 呢？当然不！换一个角度来看，Shadowsocks 简单好上手，V2Ray 复杂配置多。

2019年2月，V2Ray项目创始人Victoria Raymond突然消失，其Twitter、Telegram以及知乎。

随后开源社区进行重组成立 V2Fly 社区，并于2019年6月2日表示：“由于原开发者长期不上线，其他维护者没有完整权限。为了方便维护，我们创建了新的organization：https://github.com/v2fly 原organization中的仓库：v2ray/v2ray-core将会一直同步更新。”v2fly项目组基于v2ray项目的技术基础，fork并成立了社区化项目v2fly。
后续于2020年9月与 GitHub 官方沟通确认后，取消了与原 v2ray 项目的fork关系，正式成为独立的社区项目组织。

2019年8月2日，原作者Victoria Raymond的Telegram 频道提示：“创建此频道的用户的帐户在过去5个月中处于非活动状态。如果它在接下来的30天内仍然不活动，那么该账户将自动销毁，并且这个频道将不再拥有创建者。”
但是，原作者的Github账号依然保持更新直到2019年11月最后一次提交commits。

随后，v2fly社区的贡献者之一 rprx，给v2fly项目带来了VLESS协议，回落分流，XTLS黑科技等一系列更新，v2fly项目进入了"腹泻式"更新时期。

v2fly社区一些成员在某些技术选择及社区理念方面与 rprx 产生分歧。此后在一些其他外因的促使下，v2fly社区自 v4.33.0 版本起移除了其核心对 XTLS 的支持，但保留了 VLESS 协议支持。最终 rprx 决定独立分支并成立 project X 社区进行维护。

北京理工大学教授罗森林和两名学生王帅鹏、潘丽敏，于2019年3月25日申请名为“基于长短期记忆网络的V2ray流量识别方法”的专利。2019年10月25日，该专利的法律状态修改为“发明专利申请公布后的撤回”。

V2Ray项目组表示，专利并不会保证方法的有效性，专利仅仅是保护方法本身。其次，该专利的描述存在一些问题。
1. 专利中提到：“V2ray服务端与客户端进行每次通信时需要预先交换密钥，因而每次通信较为靠前的数据包具有显著特征”。实际上，VMess 协议并不存在“预先交换密钥”这个步骤。即使将 V2Ray 与需要进行“预先交换密钥”的协议配合使用，那么进行“预先交换密钥”时的数据包也不会有 V2Ray 的数据特征，因为此时还没有开始发送有效数据，即使有特征也是配合使用的协议的特征。
2. 专利中将 V2Ray 拼写成了 V2ray。


##### Xray和Project X

2020年11月，因为开源许可证等原因XTLS被V2Ray社区从V2ray core移除，VLESS及XTLS的作者和支持者基于V2Ray另行组建了Project X组织，开发了基于V2Ray的衍生版本Xray。该软件完全兼容V2Ray的配置文件和传输协议，由于Project X社区非常活跃，大部分新版图形化客户端已支持Xray。

2020年11月25日，Xray 1.0正式发布，成为了基于原 v2ray 项目基础的第二个社区分支版本。

Xray 项目的核心技术创新是：
- VLESS 协议
- 回落分流 防主动探测, 强大而且灵活的分流.
- XTLS 及流控 保证数据流获得标准TLS加密的同时，借助readV, Zero Copy等技术，最大限度减少数据流转过程中冗余的资源使用（表现为性能大幅提升、CPU 占用大幅降低、网速和延迟接近接近硬件的极限）
- Xray 项目的核心社区理念是：
- 活跃的开发社区
- Xray 保持着活跃的开发与更新，项目成立至今保持着每周有效更新的节奏，积极倾听社区反馈和用户痛点，快速迭代新特性、并持续解决历史遗留问题
- 明确的价值追求
- Xray项目组反对技术壁垒化、倡导社区分享和互助，坚定维护友善积极的社区氛围。


